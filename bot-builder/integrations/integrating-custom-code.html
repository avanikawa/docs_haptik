<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Code Node Integration · Haptik Docs</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Introduction"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Code Node Integration · Haptik Docs"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.haptik.ai/"/><meta property="og:description" content="## Introduction"/><meta property="og:image" content="https://docs.haptik.ai/img/image_0.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://docs.haptik.ai/img/image_0.png"/><meta name="robots" content="noindex"/><link rel="shortcut icon" href="/img/image_0.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-106563119-6', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="/js/index.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/image_0.png" alt="Haptik Docs"/><h2 class="headerTitleWithLogo">Haptik Docs</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="/#tools" target="_self">Tools</a></li><li class=""><a href="/#integrations" target="_self">Integrations</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Integrations</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/basic/introduction">Introduction</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Smart Skills</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/basic/smartskills">Introduction</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/ecommerce">Ecommerce</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/telecom">Telecom</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/insurance">Insurance</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Conversation Design</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/basic/conversation-design-introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/setting-flowchart-tool">Setting up a Flowchart tool</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/create-the-canvas">Building Blocks of Design</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/chat-initiation">Chat Initiation</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/chat-middle">Chat Middle</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/chat-end">Chat End</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/whatsapp_as_a_platform">Conversation Design on WhatsApp</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/navigation-on-whatsapp">Building IVAs on WhatsApp</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/designing-wa-hsms">WhatsApp HSMs</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/design-review">Design Review</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Essentials of Bot Building</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/basic/making-first-bot">Making Your First Bot</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/bot-hierarchy">Bot Hierarchy</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/creating-story">Creating a Story</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/creating-nodes">Creating Nodes</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/user-says-guidelines">User Says Guidelines</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/smart-variants">Smart Variants</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/bot-says">Bot Says</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/chat-elements">Chat Elements</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/connections">Connections</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/entities">Entities</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/smalltalk">Small Talk</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/general-nodes">FAQ Nodes</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/upload-graph-nodes">Upload Graph Nodes</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/searchbot">Search your IVA</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Configurations Settings</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/basic/business">Business</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/platforms-deployment">Platforms Deployment</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/copypaste">Copy &amp; Paste on Conversation Studio</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/sharebot">Share your IVA</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/transferbot">Transfer your IVA</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/bot-prompt-trigger">Bot Prompts</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">NLU</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/basic/introduction-nlu">Introduction</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/intent">Intent &amp; Entity</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/dialoguemanager">Dialogue Manager</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/managing-bot-state">Managing Bot Context and State</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/disambiguation">Did you mean? (Disambiguation)</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/smart-assist">Smart Assist</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Integrations</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/integrations/introduction">Introduction</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/bot-builder/integrations/integrating-custom-code">Code Node Integration</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/integrations/integrating-apis">Static Node Integration</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/integrations/integration-parameters">Integration Parameters</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Quality Assessment</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/basic/testing-bot">Testing your bot</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/advanced/testing-guidelines">Testing Guidelines</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/advanced/debugging-guidelines">How to debug your bot?</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/oracle-feedback">ORACLE Feedback</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/bot-qa-tool">Bot QA Tool</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Advanced</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/advanced/integrating-webviews-into-sdk">Integrating Webviews</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/advanced/integrating-with-external-bot">Integrating with External Bot</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Webhooks</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/integrations/additional-apis">Additional APIs</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Miscellaneous</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/advanced/development-guidelines">Bot Development Life Cycle</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/multiple-languages">Multilingual IVAs</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/building-voice-bots">Voice IVAs</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Code Node Integration</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="introduction"></a><a href="#introduction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>In most cases, APIs are not directly consumable by the authoring platforms. This is because the request format of the external API is generally different from the format in which the platform makes the request. Additionally, the response data from the API won’t be directly consumable by the platform as the response format for the virtual assistant is different from the response format of the API. The way most platforms solve this is by building a middleware on top of the external API to convert the request and response into appropriate formats.</p>
<p>Haptik’s Conversation Studio solves these problems in a novel way through the use of an integrated Code Editor. The Code Editor allows bot builders to easily integrate with external platforms through python scripts. This removes the requirement to build a middleware on top of the external API. The Code Editor uses a serverless implementation so it is more scalable. Another benefit of using the Code Editor is that simple dynamic behavior can be easily added through python scripts without having to build an API to do it.</p>
<p>The Code Editor provides logger support and live testing of the code. It also helps to manage IVA state by storing contextual information related to the current conversation that the user is having with the IVA. Some examples of this are policy id or policy details that the user is exploring in the current conversation.</p>
<p>The Code Editor feature allows for a quick go-to-market and significantly reduces the infrastructure cost.</p>
<p>You can open the code editor by choosing a Code Node and then clicking on the <code>Open Code Editor</code> button.</p>
<p><img src="/assets/api2.png" alt="Opening Code Editor"></p>
<h2><a class="anchor" aria-hidden="true" id="using-code-editor"></a><a href="#using-code-editor" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using Code Editor</h2>
<p>The only requirement for using the code editor is, the code should follow the below format. The supported programming language is Python 3 and above.</p>
<p>If any syntax errors or exceptions are raised by the main function, this will result in a Bot Break message.</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">import</span>  json

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">(event, context)</span>:</span>
    <span class="hljs-string">"""
    event['body'] is a string dict with the following keys:
    node, event, user, entities.

    Currently, we pass user_id, user_name, full_name, device_platform and language_code in the user dictionary.

    Args:
        event (dict): Data corresponding to this event
        context

    Returns
        (dict): response with statusCode and the response for the User
    """</span>
    body = json.loads(event[<span class="hljs-string">'body'</span>])
    entities = body[<span class="hljs-string">'entities'</span>]
    user_data = body[<span class="hljs-string">'user'</span>]
    
    <span class="hljs-comment"># This is how entities are used in code editor</span>
    <span class="hljs-comment"># entities = body.get('entities')</span>
    <span class="hljs-comment"># person_name = entities['user_name_insurance'][0]['entity_value']['value']</span>
    <span class="hljs-comment"># phone_number = entities['completion_phone_number'][0]['entity_value']</span>
    
    <span class="hljs-comment"># "custom_data" that is passed through SDK's during sign up can be accessed from body['user_details'].</span>
    user_details = body[<span class="hljs-string">'user_details'</span>]
    conversation_details = body[<span class="hljs-string">'conversation_details'</span>]
    final_response = {<span class="hljs-string">'status'</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">'response'</span>: write_here(), <span class="hljs-string">'user_details'</span>:user_details, <span class="hljs-string">'conversation_details'</span>:conversation_details}
    response = {<span class="hljs-string">'statusCode'</span>: <span class="hljs-number">200</span>, <span class="hljs-string">'body'</span>: json.dumps(final_response), <span class="hljs-string">'headers'</span>: {<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>}}
    <span class="hljs-keyword">return</span> response

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write_here</span><span class="hljs-params">(*args)</span>:</span>
    <span class="hljs-string">"""
   WRITE YOUR CODE HERE and update the final_response dict
   """</span>
    <span class="hljs-comment"># hsl_list = ['Hello', {}]</span>
    button_hsl = {
        <span class="hljs-string">"text"</span>: <span class="hljs-string">"SHOW POLICY DETAILS; PLC"</span>,
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"BUTTON"</span>,
        <span class="hljs-string">"data"</span>: {
            <span class="hljs-string">"items"</span>: [
                {
                    <span class="hljs-string">"actionable_text"</span>: <span class="hljs-string">"Policy #1"</span>,
                    <span class="hljs-string">"location_required"</span>: <span class="hljs-literal">False</span>,
                    <span class="hljs-string">"is_default"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"uri"</span>: <span class="hljs-string">"LAUNCH_CHANNEL"</span>,
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"TEXT_ONLY"</span>,
                    <span class="hljs-string">"payload"</span>: {
                        <span class="hljs-string">"gogo_message"</span>: <span class="hljs-string">""</span>,
                        <span class="hljs-string">"message"</span>: <span class="hljs-string">"I want to check my policy"</span>
                    }
                },
                {
                    <span class="hljs-string">"actionable_text"</span>: <span class="hljs-string">"View Details"</span>,
                    <span class="hljs-string">"location_required"</span>: <span class="hljs-literal">False</span>,
                    <span class="hljs-string">"is_default"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"uri"</span>: <span class="hljs-string">"LINK"</span>,
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"APP_ACTION"</span>,
                    <span class="hljs-string">"payload"</span>: {
                        <span class="hljs-string">"url"</span>: <span class="hljs-string">"XYZ.COM"</span>,
                        <span class="hljs-string">"gogo_message"</span>: <span class="hljs-string">""</span>
                    }
                }
            ]
        },
        <span class="hljs-string">"isNew"</span>: <span class="hljs-literal">False</span>
    }
    <span class="hljs-keyword">return</span> [json.dumps(button_hsl)]

</code></pre>
<p>When we run the code successfully, we get a program output in JSON format, like this</p>
<p><img src="/assets/api6.png" alt="Opening Code Editor"></p>
<p>This output format needs to be added as a Sample Output JSON Format on Code Node as well to create a connection between Code Node and Output Node.</p>
<p><img src="/assets/api7.png" alt="Opening Code Editor"></p>
<p>To connect Code node and Output Node, you can use various rules/conditions on the above output. Please refer the conditions mentioned <a href="https://docs.haptik.ai/bot-builder/basic/connections#code-node-to-output-node-connection-transition">here</a>.</p>
<p>The output JSON variables are visible when we click on <code>Add Variables</code> while creating a connection between the Output node.</p>
<p><img src="/assets/api8.png" alt="Opening Code Editor"></p>
<p>The output JSON variables are also visible when we click on <code>Add Variables</code> while creating a response under <code>Bot Says</code> of Output Node.</p>
<p><img src="/assets/api9.png" alt="Opening Code Editor"></p>
<p><strong>IMPORTANT POINTS</strong> -</p>
<ol>
<li>You can access all entities of your IVA in the above code.</li>
<li>You can call external APIs from this code as per your requirement.</li>
<li>You can send output JSON as response from the Code Editor which can be accessed in the Output Node for displaying responses to users.</li>
<li>The HSL message(Bot Says Element) that you want the IVA to respond with should be sent as a JSON in the body of the returned response object from the main function.</li>
<li>There is a 20 second time limit for code executor, which means if the API does not respond within 20 seconds of the call, the IVA will break.</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="supported-packages"></a><a href="#supported-packages" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Supported Packages</h2>
<ol>
<li><em>Default</em> - <a href="https://gist.github.com/gene1wood/4a052f39490fae00e0c3#file-all_aws_lambda_modules_python3-6-txt">List of Packages here</a></li>
<li><em>Extra packages</em> -</li>
</ol>
<p>chardet-3.0.4
gspread-3.1.0
httplib2-0.13.1
idna-2.8
mysqlclient-1.4.2
oauth2client-4.1.3
pyasn1-0.4.6
pyasn1-modules-0.2.6
pytz-2019.2
redis-3.2.1
requests-2.22.0
rsa-4.0
six-1.12.0
unicodecsv-0.14.1
urllib3-1.25.3</p>
<h2><a class="anchor" aria-hidden="true" id="create-hsls-in-code-editor"></a><a href="#create-hsls-in-code-editor" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create HSLs in Code Editor</h2>
<p>You can use HSL message(Bot Says Element) to display different elements on the bot, such as carousels and buttons. To display HSLs using code node, we first have to copy the HSL from any static node, with the required elements such as a button. The procedure to copy an HSL is mentioned <a href="https://docs.haptik.ai/bot-builder/basic/copypaste#how-to-copy-and-paste-the-hsls">here</a>.</p>
<p><img src="/assets/api10.png" alt="Opening Code Editor"></p>
<p>Change the True and False flags according to Python conventions as shown below</p>
<p><img src="/assets/api11.png" alt="Opening Code Editor"></p>
<p>Once you create a variable to store the entity information, we can use it in the HSL as follows</p>
<p><img src="/assets/api12.png" alt="Opening Code Editor"></p>
<p>Here, we have created a button HSL to display the message “Your email is <email>” and a button which redirects to Haptik’s website. When the code is executed on the IVA, it appears as follows,</p>
<p><img src="/assets/api13.png" alt="Opening Code Editor"></p>
<h2><a class="anchor" aria-hidden="true" id="using-environment-variables"></a><a href="#using-environment-variables" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using Environment Variables</h2>
<p>You can set environment variables for the code executor to store values like database username and passwords that you don't want to expose inside the code.</p>
<p><strong>The environment variables are stored at a bot level.</strong> This means that variables stored in one node are automatically available to all nodes inside the bot.</p>
<p>You can set these variables by opening the code editor, clicking on the <code>More</code> button in the top right corner</p>
<p><img src="/assets/api3.png" alt="Opening Code Editor"></p>
<p>and selecting the <code>Variables</code> option.</p>
<p><img src="/assets/api4.png" alt="Opening Code Editor"></p>
<p>In the <code>variables</code> menu that opens, you can set the variable name and values for the variable on the staging and production environments. For example you can create a variable called <code>MONGO_URI</code> and set its staging value as <code>mongodb://mongodb0.example.com:27017/admin</code> and it's production value as <code>mongodb://mongodb1.example.com:27017/admin</code>.</p>
<p><img src="/assets/api5.png" alt="Opening Code Editor"></p>
<p>These environment variables are then available within the request parameters for the integration functions. You can read about the request parameter structure <a href="https://docs.haptik.ai/bot-builder/integrations/integration-parameters">here</a></p>
<blockquote>
<p>Note: There is a <strong>character limit of 50</strong> to store the environment variables. If this limit exceeds, the IVA will break.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="saving-conversation-details-and-user-details-in-the-code-editor"></a><a href="#saving-conversation-details-and-user-details-in-the-code-editor" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Saving Conversation Details and User Details in the Code Editor</h2>
<h3><a class="anchor" aria-hidden="true" id="what-is-bot-state"></a><a href="#what-is-bot-state" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What is Bot State</h3>
<p>Bot State is nothing but data or information associated with a user or contextual data for the specific conversation that the user is having. You can set and access data for both of these scopes with the help of <code>context variables</code> to help you manage your bot's state.</p>
<p>Based on the scope of the bucket your data will be available within all nodes of the bot. The two scopes that are currently supported are:</p>
<ul>
<li><strong>User Details</strong> for user level data.</li>
<li><strong>Conversation Details</strong> for conversation level data.</li>
</ul>
<p><img src="/assets/bot-builder-manage-state/scope.png" alt="Data Scopes"></p>
<p>The Context Variables are available as part of the <code>Event</code> payload that is passed to the integration functions. The integration function can then <code>SET/GET</code> data from these variables.</p>
<p>Post the execution of the integration function, the data is committed to a permanent store and the permanance is based on the scope the data belongs to.</p>
<h3><a class="anchor" aria-hidden="true" id="conversation-details"></a><a href="#conversation-details" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conversation Details</h3>
<p>Data stored in this context variable will be saved at a conversation level for a given user. This means that the data will only be available till the conversation is active and is not marked as complete. Once the conversation is marked as complete, any data stored in this scope for the given user will be lost.</p>
<p>This data is maintained on our server for a maximum of 3 hours after which it is permanently lost.</p>
<p>This scope should be used for storing contextual information related to the current conversation that the user is having with the bot. Some examples of this are policy id or policy details that the user is exploring in the current conversation.</p>
<p>conversation_detail is used to store information which will be needed as long as the current conversation is going on. The initial information which conversation details contain is empty i.e. {}.</p>
<p>For instance, consider a use-case where a user wants to renew a policy, the user will choose the option to renew his/her policy and the API returns a list of policies associated with them. When the user selects their policy number, we cannot add it in an entity since the policy number can change and is perishable. But, we can use conversation details and store this policy number.</p>
<p><strong>Things to remember while using Conversation details:</strong></p>
<ol>
<li>The information which is stored should be related to the conversation.</li>
<li>The Data storage limit is 2500 characters.</li>
<li>The data in conversation details stays for 3 hours only.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="user-details"></a><a href="#user-details" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>User Details</h3>
<p>Data stored in this context variable will be saved at a user level and will be available for all the conversations that the user has. Data inside user_details will be available across bots and businesses as long as the underlying user is the same in the database.</p>
<p>This context variable should be used for storing permanent details about the user that are not specific to a given conversation like their email, phone number or other such details.</p>
<blockquote>
<p>Value in user_details schema expects data to be a string type. If the user wants to store a list corresponding to the user detail key, then they should handle the serializer/deserializer logic inside the code before returning the response from the code node.</p>
</blockquote>
<p>The default value for user details is {'language_code': 'en', 'name': 'Guest User'}</p>
<p><strong>Why use user_details?</strong>
We collect information from the user such as PAN number, Aadhar number etc which is stored in the entity, but when the user journey hits an end node on the IVA, the entities get flushed away.</p>
<p>So when the user is returning on the IVA, we will have to ask them these details again. Using user_details will help to solve this problem. When we store information such as PAN number or phone number, the bot will not ask for these entities again since it is stored locally.</p>
<p><strong>Things to remember while using user_details:</strong></p>
<ol>
<li>The information which is stored should be related to the user.</li>
<li>The data stored in user-details is permanent. As long as the user does not clear their browser cache.</li>
<li>The data storage limit is 200 characters.</li>
</ol>
<blockquote>
<p>Tip: Store such data which is never going to change such as date-of-birth</p>
</blockquote>
<p><img src="/assets/api16.png" alt="Opening Code Editor"></p>
<h2><a class="anchor" aria-hidden="true" id="logger-support-in-code-executor"></a><a href="#logger-support-in-code-executor" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Logger support in Code Executor</h2>
<p>You can use standard python logging library inside the code editor. See the below snippet for reference</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">import</span>  json
<span class="hljs-keyword">import</span> logging
logger = logging.getLogger()
logger.setLevel(logging.INFO)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">(event, context)</span>:</span>
    final_response = {<span class="hljs-string">'status'</span>: <span class="hljs-literal">True</span>}
    logger.info(final_response)
    response = {<span class="hljs-string">'statusCode'</span>: <span class="hljs-number">200</span>, <span class="hljs-string">'body'</span>: json.dumps(final_response), <span class="hljs-string">'headers'</span>: {<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>}}
    <span class="hljs-keyword">return</span> response
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="live-testing-your-code"></a><a href="#live-testing-your-code" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Live Testing your Code</h2>
<p>The full screen code editor allows you to live test your code with a configurable input. This will help you evaluate if your code is working as expected.</p>
<p>You can configure the input by modifying the JSON in the <code>Sample Input Data</code> section at the bottom of the code editor. The only requirement is that the input JSON should have these keys mandatorily:</p>
<ul>
<li>entities - This key will contain data about the entities captured in the bot.</li>
<li>user_data - This key will contain data about the user.</li>
</ul>
<p>After configuring the input json data you can test the code by clicking on the <code>Run</code> button at the top of the screen.</p>
<blockquote>
<p><strong>Note</strong>: You need to save the code to be able to run it.</p>
</blockquote>
<p>When you click on the <code>Run</code> button, the code will be executed using the sample input data and the output and logs will be shown at the bottom of the code executor window.</p>
<p><img src="/assets/RunCode.png" alt="Code Run"></p>
<p>When we test the code on the bot, logs are created every time a code node is executed. The View Logs option is present on the Code Node, under Open Code Editor button.</p>
<p><img src="/assets/api14.png" alt="Opening Code Editor"></p>
<p>When we click on View Logs button, it will open a screen where we can check all the logs when the code node was executed. This information is retained for the day. The following is the image of sample logs.</p>
<p><img src="/assets/viewlogs.png" alt="Opening Code Editor"></p>
<h2><a class="anchor" aria-hidden="true" id="pre-transfer"></a><a href="#pre-transfer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pre-Transfer</h2>
<p><code>Train Bot</code> prepares the code for production. Hence, you should make sure to call <code>Train Bot</code> if there are any changes in the custom code integration before transferring the bot to production.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 3/3/2021</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/bot-builder/integrations/introduction"><span class="arrow-prev">← </span><span>Introduction</span></a><a class="docs-next button" href="/bot-builder/integrations/integrating-apis"><span>Static Node Integration</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#introduction">Introduction</a></li><li><a href="#using-code-editor">Using Code Editor</a></li><li><a href="#supported-packages">Supported Packages</a></li><li><a href="#create-hsls-in-code-editor">Create HSLs in Code Editor</a></li><li><a href="#using-environment-variables">Using Environment Variables</a></li><li><a href="#saving-conversation-details-and-user-details-in-the-code-editor">Saving Conversation Details and User Details in the Code Editor</a><ul class="toc-headings"><li><a href="#what-is-bot-state">What is Bot State</a></li><li><a href="#conversation-details">Conversation Details</a></li><li><a href="#user-details">User Details</a></li></ul></li><li><a href="#logger-support-in-code-executor">Logger support in Code Executor</a></li><li><a href="#live-testing-your-code">Live Testing your Code</a></li><li><a href="#pre-transfer">Pre-Transfer</a></li></ul></nav></div><footer class="nav-footer" id="footer"><div class="footer"><a href="https://haptik.ai/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/image_0.png" alt="Haptik Inc." width="100"/></a><div class="footer-columns"><div class="footer-column"><div class="footer-column-title">Tools</div><div class="footer-column-links"><a href="https://docs.haptik.ai/bot-builder/basic/introduction" class="footer-column-link">Conversation Studio</a><a href="https://docs.haptik.ai/agent-chat/" class="footer-column-link">Smart Agent Chat</a><a href="https://docs.haptik.ai/bot-analytics/" class="footer-column-link">Intelligent Analytics</a></div></div><div class="footer-column"><div class="footer-column-title">Integrations</div><div class="footer-column-links"><a href="https://docs.haptik.ai/ios-sdk/" class="footer-column-link">iOS SDK</a><a href="https://docs.haptik.ai/android-sdk/" class="footer-column-link">Android SDK</a><a href="https://docs.haptik.ai/web-sdk/" class="footer-column-link">Web SDK</a><a href="https://docs.haptik.ai/whatsapp/" class="footer-column-link">WhatsApp</a><a href="https://docs.haptik.ai/other/facebook" class="footer-column-link">Facebook</a><a href="https://docs.haptik.ai/webhooks/" class="footer-column-link">Bot API</a></div></div><div class="footer-column"><div class="footer-column-title">Others</div><div class="footer-column-links"><a href="https://docs.haptik.ai/hsl/" class="footer-column-link">HSL</a><a href="https://docs.haptik.ai/other/sla" class="footer-column-link">SLA</a><a href="https://docs.haptik.ai/external-chat-tool/" class="footer-column-link">External Agent Chat Tool</a></div></div></div><div class="footer-copyright"></div></div><section class="copyright">Copyright © 2021 Haptik Inc.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '224c7079e67e84a978d8b4621f6af16d',
                indexName: 'haptik',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>